# Exporting analysis results

**Audience:** everyone (especially wet lab + computational users preparing reports)  
**Time:** 10–20 minutes  
**What you’ll learn:**
- What analysis artifacts can be exported (tables, plots)
- What exports are “stable artifacts” vs ephemeral UI state
- How analysis exports relate to Figure Export and Sessions

**Prerequisites:**
- A dataset loaded
- At least one analysis result generated (any mode)

---

## What “export” means in Analysis (and what it does not mean)

Cellucid’s Analysis UI supports exporting **two kinds of artifacts**:

1) **Plots** (PNG / SVG)  
   A snapshot of *what you see* in the analysis result plot at the time you export.

2) **Tables** (CSV)  
   A machine-readable artifact you can load into R/Python/Excel.

Exports are **downloads from your browser**:
- files typically land in your OS/browser “Downloads” location,
- filenames are generated by the app (you can rename them after download).

Exports are **not**:
- a substitute for {doc}`../l_sessions_sharing/index` (sessions capture state/settings),
- a substitute for {doc}`../k_figure_export/index` (publication-grade export of the main view),
- a guarantee that you can reproduce the exact result later *without also recording settings*.

:::{important}
In the current build, most analysis CSVs do **not** embed full provenance (dataset id, page names, thresholds, etc.).

If you need paper-grade reproducibility, export the CSV **and** save a session (and/or keep a lab notebook record of settings).
:::

---

## Fast path (save something you can share)

Goal: export **one plot** for reporting and **one table** for re-analysis.

1) Run the analysis you care about (Detailed / Correlation / DE / Gene Signature / Marker Genes)
2) Open the expanded view
   - click the plot preview, or click `⤢ Expand` (mode-dependent)
3) In the expanded view, use the export buttons
   - `PNG` / `SVG` for plots
   - `CSV` for tables
4) Immediately rename the downloaded files (recommended)
   - include dataset name, page names, method, and date, e.g.  
     `pbmc_demo__DE__T_cells_vs_rest__wilcox__2025-01-02.csv`

:::{tip}
For wet lab / reporting workflows:
- export `PNG` for slides and lab meeting decks,
- export `SVG` only if you need vector editing (Illustrator/Inkscape),
- export `CSV` for anything you might re-plot or statistically analyze later.
:::

---

## Where export controls live (UI map)

Exports are attached to the **analysis result view**, not to the overall app.

Typical patterns:
- **Detailed Analysis**: click the plot preview to open an expanded modal; export from there.
- **DE / Gene Signature / Marker Genes**: use `⤢ Expand` (or click the preview) to open the expanded modal; export from there.
- **Quick**: no formal “export” controls (use it as a summary; screenshot if needed).

In the expanded view you should see an `Export:` row with buttons:
- `PNG`
- `SVG`
- `CSV`

If you don’t see export controls, it usually means:
- no result has been computed yet, or
- the mode does not support export, or
- you are not in the expanded modal view.

---

## What each mode exports (exact CSV schemas)

This section is deliberately explicit so you can build downstream tooling.

### Detailed Analysis

- **Plot export:** `PNG` / `SVG` of the currently selected plot type and options.
- **CSV export:** per-cell values for the selected variable.
  - Filename: `detailed-analysis-data.csv`
  - Columns:
    - `page`: the page name
    - `cell_index`: the dataset row index for that value (0-based)
    - `<variable>`: the exported numeric value

:::{note}
This CSV can be large: it is one row per cell (per selected page).
For very large pages, consider exporting summary results instead of per-cell values.
:::

### Correlation

- **Plot export:** `PNG` / `SVG` of the correlation scatter plot as rendered.
- **CSV export:** one row per page with correlation statistics.
  - Filename: `correlation_results.csv`
  - Columns:
    - `page`
    - `method` (`pearson` or `spearman`)
    - `x_type`, `x_key` (what X is)
    - `y_type`, `y_key` (what Y is)
    - `r`, `r_squared`
    - `p_value`
    - `n` (paired values used)

:::{note}
The exported plot may show a downsampled subset of points for rendering performance.
The exported CSV statistics (`r`, `p_value`, `n`) are computed on the full paired data.
:::

### Differential Expression (DE)

- **Plot export:** `PNG` / `SVG` of the volcano plot with current thresholds/options.
- **CSV export:** one row per gene with DE statistics.
  - Filename: `differential_expression.csv`
  - Columns:
    - `gene`
    - `meanA`, `meanB`
    - `log2FoldChange`
    - `pValue`
    - `adjustedPValue` (BH/FDR)

:::{important}
The DE CSV does not include the compared page names.
Record Page A vs Page B yourself (file rename, notes, or session).
:::

### Gene Signature

- **Plot export:** `PNG` / `SVG` of the signature score plot.
- **CSV export:** signature scores as a long table.
  - Filename: `gene_signature_scores.csv`
  - Columns:
    - `page`
    - `score`

:::{warning}
This CSV does **not** include cell indices.
If you need to map scores back to specific cells, export a session and recompute in Python where you can attach indices/obs.
:::

### Marker Genes (Genes Panel)

Marker Genes exports depend on what you’re looking at:

- **Heatmap-style exports** (Clustered / Custom Genes)
  - Filename: `marker_genes_heatmap.csv`
  - Shape: wide matrix
  - Columns:
    - `gene` (first column)
    - one column per group (column headers are group names)
  - Values: per-group mean expression for each gene, using the **current heatmap transform** (e.g., z-score/log1p/none).

- **Ranked markers exports** (Ranked Genes)
  - Filename: `marker_genes_ranked.csv`
  - Columns:
    - `group`, `gene`, `rank`
    - `log2FoldChange`, `pValue`, `adjustedPValue`
    - `meanInGroup`, `meanOutGroup`
    - `percentInGroup`, `percentOutGroup`

:::{note}
If your group labels contain commas, `marker_genes_heatmap.csv` may be harder to parse in strict CSV readers.
If possible, avoid commas in categorical labels used for grouping.
:::

---

## Reproducibility notes (what to record)

If you need to reproduce an export later, record:
- dataset identity (dataset name/id, export folder version)
- active view/snapshot (if relevant to your workflow)
- selected pages (names + sizes)
- selected variables (obs key / gene id + how genes are resolved)
- method settings (Pearson vs Spearman; Wilcoxon vs t-test; signature normalization; performance settings)
- thresholds and plot options (DE volcano thresholds; log axes; labeling settings)

Recommended workflow:
1) Save a session: {doc}`../l_sessions_sharing/index`
2) Export CSV(s)
3) Export plot(s) (PNG for sharing; SVG for editing)
4) Rename files with the important settings

---

## Troubleshooting exports

### Symptom: “Nothing downloads when I click PNG/SVG/CSV”

Likely causes:
- browser blocked automatic downloads,
- you are not in the expanded view (no export toolbar),
- the analysis did not produce a result yet.

Fix:
- re-run the analysis and open the expanded view,
- allow downloads for the site,
- try a different browser if corporate policies block downloads.

### Symptom: “The CSV is empty”

Likely causes:
- the analysis returned no valid values (missing data, tiny pages, all-NaN),
- gene expression is unavailable (expression-based modes),
- the mode exports a different artifact than you expected (e.g., correlation exports summary statistics, not point-level data).

Fix:
- confirm you have non-empty pages,
- confirm gene expression is available,
- verify the mode’s expected CSV schema above,
- see {doc}`10_troubleshooting_analysis` for analysis-wide diagnosis.

---

## Screenshot placeholders (you will replace later)

<!-- SCREENSHOT PLACEHOLDER
ID: analysis-export-controls
Suggested filename: analysis/20_export-controls.png
Where it appears: User Guide → Web App → Analysis → 09_exporting_analysis_results.md
Capture:
  - UI location: expanded analysis modal showing the `Export: PNG SVG CSV` controls
  - State prerequisites: analysis has produced a result with exportable outputs
  - Action to reach state: run analysis → open expanded view → locate export controls
Crop:
  - Include: export buttons/menus + a small portion of the result they export
Alt text:
  - Export controls for downloading analysis results.
Caption:
  - Use the analysis export controls to save tables and plots; prefer tables when you need downstream re-analysis.
-->
```{figure} ../../../_static/screenshots/placeholder-screenshot.svg
:alt: Placeholder screenshot for analysis export controls.
:width: 100%

Analysis results can be exported as tables and/or plots (depending on mode); export tables when you need downstream computation.
```

<!-- SCREENSHOT PLACEHOLDER
ID: analysis-export-artifact-example
Suggested filename: analysis/21_export-artifact-example.png
Where it appears: User Guide → Web App → Analysis → 09_exporting_analysis_results.md
Capture:
  - Export one artifact (CSV/PNG/SVG) and open it in an external viewer/editor
  - If possible, keep the app visible in the background for provenance context
Redact:
  - Remove: private dataset identifiers, sample names, file paths if sensitive
Alt text:
  - An exported analysis artifact opened outside the web app.
Caption:
  - Exported artifacts are the most shareable form of analysis output; they remain usable outside Cellucid.
-->
```{figure} ../../../_static/screenshots/placeholder-screenshot.svg
:alt: Placeholder screenshot for an exported analysis artifact example.
:width: 100%

Open exported CSV/PNG/SVG artifacts outside the app to confirm they are shareable and self-contained.
```

---

## Next steps

- {doc}`../k_figure_export/index` (publication-grade figure export for the full view)
- {doc}`10_troubleshooting_analysis` (downloads missing, empty exports)
- {doc}`../l_sessions_sharing/index` (saving/restoring analysis state)
